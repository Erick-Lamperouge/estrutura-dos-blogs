{% assign ga_id = site.analytics.id | default: site.data.theme_defaults.analytics.id %}
{% assign ga_ok = (site.analytics.provider == "ga4" and ga_id) or (site.data.theme_defaults.analytics.provider == "ga4" and ga_id) %}
{% if ga_ok %}
<script async src="https://www.googletagmanager.com/gtag/js?id={{ ga_id }}"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){ dataLayer.push(arguments); }
  gtag('js', new Date());

  (function () {
    var base = document.body?.dataset?.baseurl || '{{ site.baseurl | default: "" }}';
    var siteId = (base || '/').replace(/^\/|\/$/g,'') || 'root';

    gtag('config', '{{ ga_id }}', { send_page_view: false, anonymize_ip: true });
    gtag('event', 'page_view', {
      page_location: location.href,
      page_path: location.pathname,
      page_title: document.title,
      site_id: siteId
    });
  })();
</script>
{% endif %}
